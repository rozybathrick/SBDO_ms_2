<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Overview</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Overview</h1>



<div id="disclaimer" class="section level2">
<h2>Disclaimer</h2>
<p>This vignette is an extended set of examples to highlight
<code>aniMotum</code>’s functionality. Please, do NOT interpret these
examples as instructions for conducting analysis of animal movement
data. Numerous essential steps in a proper analysis have been left out
of these vignettes. It is your job to understand your data, ensure you
are asking the right questions of your data, and that the analyses you
undertake appropriately reflect those questions. We can not do this for
you!</p>
<div id="models" class="section level3">
<h3>Models</h3>
<p>This is an overview of how to use <code>aniMotum</code> to filter
animal track locations obtained via the Argos satellite system or
(possibly) another tracking system. <code>aniMotum</code> provides three
state-space models (SSM’s), two for filtering (ie. estimating “true”
locations and associated movement model parameters, while accounting for
error-prone observations), and another for filtering and estimating move
persistence - an index of movement behaviour:</p>
<ul>
<li>a simple <em>Random Walk</em> model, <code>rw</code></li>
<li>a <em>Correlated Random Walk</em> model, <code>crw</code></li>
<li>a <em>Move Persistence</em> model, <code>mp</code></li>
</ul>
<p>the models are continuous-time models, that is, they account for the
time intervals between successive observations, thereby naturally
accounting for the often irregularly-timed nature of animal tracking
data. We won’t dwell on the details of the models here (see Jonsen et
al. 2020 for details on the <code>crw</code> model), except to say there
may be advantages to choosing one over the other in certain
circumstances. The <em>Random Walk</em> model tends not to deal well
with small to moderate gaps (relative to a specified time step) in
observed locations and can over-fit to particularly noisy data. The
<em>Correlated Random Walk</em> model can often deal better with these
small to moderate data gaps and appropriately smooth through noisy data
but tends to estimate nonsensical (i.e., ‘looping’ artefacts) movement
through longer data gaps, especially when animals are mostly stationary
during those gaps. The <em>Move Persistence</em> model can be more
robust to data gaps up to a point, and estimates time-varying move
persistence <span class="math inline">\(\gamma_t\)</span> along the
track, which provides an index of how an animal’s movement behaviour
varies in space and time based on the autocorrelation of successive
movements. If you have Argos location data and your goal is to infer
changes in movement behaviour along tracks then estimating locations and
move persistence simultaneously within a state-space model is the
preferred approach, as location uncertainty is accounted for in the move
persistence estimates.</p>
<p>Additionally, <code>aniMotum</code> provides separate models
(<code>mpm</code>, <code>jmpm</code>) for estimating move persistence
<em>after</em> fitting either the <code>rw</code> or <code>crw</code>
SSM (see Jonsen et al. 2019 for details). Using the <code>fit_mpm</code>
function, the <code>mpm</code> is fit to individual tracks, whereas the
<code>jmpm</code> is fit to multiple tracks simultaneously with a
variance parameter that is estimated jointly across the tracks. This
latter model may better resolve subtle changes in movement behaviour
along tracks that lack much contrast in movements. Both models can be
fit to time-regularized locations or to time-irregular locations. See
Auger-Méthé et al. (2017) for an example of the latter. These models can
be fit to animal tracks, regardless of the geolocation technology used,
but they assume that locations are known without error.</p>
</div>
<div id="data" class="section level3">
<h3>Data</h3>
<p><code>aniMotum</code> can accept input data in several possible
formats. Here, we outline the default formats but users are not
restricted to using these. Input data with variable names and/or column
ordering that differs from the defaults can be used, provided the
essential minimum data elements are present to allow the SSM’s to be
fitted: a unique animal/track identifier, date-time of each observation,
location quality class, and longitude and latitude (or projected x and
y) coordinates. We expand on these and additional variables in the
following sections.</p>
<p>A pre-processing function <code>format_data()</code> can be used to
correctly structure the input data for use in <code>aniMotum</code>.
This function checks for the presence of the essential variables,
converts date-time to <code>POSIX</code> format, maps custom variable
names onto the default names, and puts the variables into the default
column order expected by <code>aniMotum</code>. Users may choose to call
<code>format_data()</code> themselves, prior to fitting an SSM with
<code>fit_ssm()</code>, or they can allow <code>fit_ssm()</code> to
format the data automatically. We illustrate these approaches in the
“Fitting a model” section, below.</p>
<div id="argos-least-squares-ls-location-data" class="section level4">
<h4>Argos Least-Squares (LS) location data</h4>
<p>We’ll start out with the original Argos data, CLS Argos’
Least-Squares-based (LS) locations. These data contain the minimum
information required by <code>aniMotum</code>’s SSM’s. A minimal input
<code>data.frame</code> or <code>tibble</code>, containing only the
information required to fit the SSM, looks like this:</p>
<pre><code>#&gt;             id                date lc   lon    lat
#&gt; 1 ct109-085-14 2015-02-03 00:11:02  B 70.45 -49.93
#&gt; 2 ct109-085-14 2015-02-03 13:26:37  B 71.00 -50.21
#&gt; 3 ct109-085-14 2015-02-03 21:53:15  B 71.31 -50.37
#&gt; 4 ct109-085-14 2015-02-04 04:05:35  A 71.64 -50.43
#&gt; 5 ct109-085-14 2015-02-04 17:12:42  B 72.04 -50.46
#&gt; 6 ct109-085-14 2015-02-05 02:05:44  B 72.44 -50.47</code></pre>
<p>The (default) column names represent the following:<br />
- <code>id</code> a unique identifier for each animal (or track) in the
<code>data.frame</code><br />
- <code>date</code> a date-time variable in the form
<code>YYYY-mm-dd HH:MM:SS</code> (or <code>YYYY/mm/dd HH:MM:SS</code>).
These can be text strings, in which case <code>aniMotum</code> converts
them to <code>POSIX</code> format and assumes the timezone is
<code>UTC</code>. If the date-times are from a local timezone then you
must specify this via the <code>tz</code> argument to
<code>format_data()</code>. A list of valid timezone names can be viewed
via <code>OlsonNames()</code>.<br />
- <code>lc</code> the location class variable common to Argos data, with
classes in the set: 3, 2, 1, 0, A, B, Z.<br />
- <code>lon</code> the longitude variable<br />
- <code>lat</code> the latitude variable<br />
The <code>lc</code> values determine the measurement error variances
(based on independent data, see Jonsen et al. 2020) used in the SSM’s
for each observation.</p>
</div>
<div id="argos-kalman-filter-kf-location-data" class="section level4">
<h4>Argos Kalman Filter (KF) location data</h4>
<p>Since 2011, the default Argos location data uses CLS Argos’ Kalman
Filter (KF) algorithm. These data include error ellipse information for
each observed location in the form of 3 variables: ellipse semi-major
axis length, ellipse semi-minor axis length, and ellipse orientation. A
minimal input <code>data.frame</code> or <code>tibble</code> for Argos
KF data looks like this:</p>
<pre><code>#&gt;      id                date lc      lon       lat  smaj smin eor
#&gt; 1 54591 2012-03-05 05:09:33  1 110.5707 -66.42752  2442  416  42
#&gt; 2 54591 2012-03-06 04:55:14  0 110.3402 -66.39579 49660  391  90
#&gt; 3 54591 2012-03-07 04:23:10  A 110.4778 -66.45266  5032  472  93
#&gt; 4 54591 2012-03-07 21:23:06  A 110.3749 -66.39622  4007  286 116
#&gt; 5 54591 2012-03-09 04:27:49  B 110.4732 -66.48743 13063  956  82
#&gt; 6 54591 2012-03-10 00:10:41  A 110.5014 -66.43516  5099  478  79</code></pre>
<p>The column names follow those for Argos LS data, with the following
additions:<br />
- <code>smaj</code> the Argos error ellipse semi-major axis length
(m)<br />
- <code>smin</code> the Argos error ellipse semi-minor axis length
(m)<br />
- <code>eor</code> the Argos error ellipse ellipse orientation (degrees
from N)</p>
<p>Here, the error ellipse parameters for each observation define the
measurement error variances used in the SSM’s (Jonsen et al. 2020).
Missing error ellipse values are allowed, in which case, those
observations are treated as Argos LS data.</p>
</div>
<div id="gps-location-data" class="section level4">
<h4>GPS location data</h4>
<p>The <code>aniMotum</code> SSM’s can be fit to GPS location data, for
example to deal with (rare) extreme locations and/or to time-regularise
locations. The input data format is the same as for Argos LS data, but
the <code>lc</code> class is set to <code>G</code> for all GPS
locations:</p>
<pre><code>#&gt;         id                date lc  lon   lat
#&gt; 1 F02-B-17 2023-03-15 13:21:49  G 70.1 -49.2
#&gt; 2 F02-B-17 2023-03-15 14:21:49  G 70.6 -48.2
#&gt; 3 F02-B-17 2023-03-15 15:21:49  G 71.1 -47.2
#&gt; 4 F02-B-17 2023-03-15 16:21:49  G 71.6 -46.2
#&gt; 5 F02-B-17 2023-03-15 17:21:49  G 72.1 -45.2</code></pre>
</div>
<div id="light-level-geolocation-data" class="section level4">
<h4>Light-level geolocation data</h4>
<p>The <code>aniMotum</code> SSM’s can be fit to processed light-level
geolocation data, when they include longitude and latitude error SD’s
(<code>lonerr</code>, <code>laterr</code>; units in degrees). In this
case, the <code>lc</code> class is set to <code>GL</code> for all
geolocation observations:</p>
<pre><code>#&gt;      id                date lc   lon lat    lonerr     laterr
#&gt; 1 54632 2023-03-15 13:21:49 GL 100.0 -55 0.2946832 2.48767133
#&gt; 2 54632 2023-03-16 01:21:49 GL 100.5 -54 0.8328811 0.02319244
#&gt; 3 54632 2023-03-16 13:21:49 GL 101.0 -53 0.3103666 1.35072295
#&gt; 4 54632 2023-03-17 01:21:49 GL 101.5 -52 0.7412578 0.31586369
#&gt; 5 54632 2023-03-17 13:21:49 GL 102.0 -51 0.2716705 3.93959806</code></pre>
<p>We caution users, that light-level geolocation errors can be (highly)
non-Gaussian, depending on the species, tag technology, and algorithm
used to estimate location from the light-level data. For example, we
have observed strongly non-Gaussian location uncertainty in tracks of
highly migratory tunas that traverse very different water masses in both
the vertical and horizontal directions. Because <code>aniMotum</code>’s
SSM’s assume bi-variate Normal location errors, fitting to geolocations
with non-Gaussian errors would not be appropriate and likely result in
highly biased location estimates. Geolocation data collected from birds
may be less prone to this issue, but we urge users to explore both the
uncertainty in their tracking data and the algorithm used to estimate
locations from light-level data.</p>
</div>
<div id="projected-location-data" class="section level4">
<h4>Projected location data</h4>
<p>Users can provide projected location data as an
<code>sf-tibble</code> or <code>sf data.frame</code>. By default,
<code>aniMotum</code>’s SSM’s fit to locations that are transformed to
the Mercator projection (EPSG 3395) and estimated locations are
back-transformed to spherical coordinates (lon, lat). When an
<code>sf</code>-projected data set is supplied, the
<code>aniMotum</code> SSM’s are fit to locations on the supplied
projection (<code>aniMotum</code> ensures that distance units are set to
km). Here is an example <code>sf-tibble</code> Argos data set in a polar
stereographic projection:</p>
<pre><code>#&gt; Simple feature collection with 6 features and 6 fields
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: 1110.769 ymin: -948.5686 xmax: 1118.995 ymax: -936.6922
#&gt; CRS:           +proj=stere +lat_0=-60 +lon_0=85 +ellps=WGS84 +units=km +no_defs
#&gt; # A tibble: 6 × 7
#&gt;   id    date                lc     smaj  smin   eor             geometry
#&gt;   &lt;chr&gt; &lt;dttm&gt;              &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;         &lt;POINT [km]&gt;
#&gt; 1 54591 2012-03-05 05:09:33 1      2442   416    42 (1118.995 -944.0405)
#&gt; 2 54591 2012-03-06 04:55:14 0     49660   391    90 (1110.769 -936.6922)
#&gt; 3 54591 2012-03-07 04:23:10 A      5032   472    93 (1114.021 -945.0264)
#&gt; 4 54591 2012-03-07 21:23:06 A      4007   286   116  (1112.198 -937.343)
#&gt; 5 54591 2012-03-09 04:27:49 B     13063   956    82 (1112.307 -948.5686)
#&gt; 6 54591 2012-03-10 00:10:41 A      5099   478    79 (1115.773 -943.6181)</code></pre>
</div>
<div id="a-mixture-of-location-data-types" class="section level4">
<h4>A mixture of location data types</h4>
<p>Users can fit SSM’s to data where a combination of Argos, GPS or
light-level geolocation observations are inter-mixed. Below is an
example of mixed Argos KF and GPS observations, as one might obtain from
a double-tagged individual:</p>
<pre><code>#&gt;         id                date lc  lon   lat  smaj smin eor
#&gt; 1 F02-B-17 2017-09-17 05:20:00  G 70.1 -49.2    NA   NA  NA
#&gt; 2 F02-B-17 2017-10-04 14:35:01  2 70.2 -49.1  1890   45  77
#&gt; 3 F02-B-17 2017-10-05 04:03:25  G 70.1 -49.3    NA   NA  NA
#&gt; 4 F02-B-17 2017-10-05 06:28:20  A 71.1 -48.7 28532 1723 101
#&gt; 5 F02-B-17 2017-10-05 10:21:18  B 70.8 -48.5 45546 3303  97</code></pre>
<p>These mixtures are possible because the <code>aniMotum</code> SSM’s
apply the most appropriate measurement error model for each observation,
based on its location class and error information (i.e., numeric values
vs NA’s).</p>
</div>
</div>
<div id="fitting-a-model" class="section level3">
<h3>Fitting a model</h3>
<p>Model fitting for quality control of locations is comprised of 3
steps: a data formatting step, a pre-filtering step, and the actual
model fitting step. A number of checks are made on the input data during
the formatting and pre-filtering steps, including applying the
<code>trip::sda</code> filter to identify extreme observations (see
<code>?fit_ssm</code> for details). The pre-filter step is fully
automated, although various arguments can be used to modify it’s
actions, and called via the <code>fit_ssm</code> function:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">## format, prefilter and fit Random Walk SSM using a 24 h time step</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_ssm</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> ellie,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="st">&quot;rw&quot;</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">time.step =</span> <span class="dv">24</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>These are the minimum arguments required: the input data, the model
(<code>rw</code>, <code>crw</code>, or <code>mp</code>) and the
time.step (in h) to which locations are predicted. Additional control
can be exerted over the data formatting and pre-filtering steps, via the
<code>id</code>, <code>date</code>, <code>lc</code>, <code>coord</code>,
<code>epar</code> and <code>sderr</code> variable name arguments, and
via the <code>vmax</code>, <code>ang</code>, <code>distlim</code>,
<code>min.dt</code>, and <code>spdf</code> pre-filtering arguments (see
<code>?fit_ssm</code> for details). The defaults for these arguments are
quite conservative (for non-flying species), usually leading to relative
few observations being flagged to be ignored by the SSM. Additional
control over the optimization can also be exerted via the
<code>control = ssm_control()</code> argument, see see
<code>vignette(&#39;SSM_fitting&#39;)</code> and <code>?ssm_control</code> for
more details.</p>
<div id="custom-data-formats" class="section level4">
<h4>Custom data formats</h4>
<p>Users do not need to adhere to the default <code>aniMotum</code> data
formatting presented above, so long as their input data contain the
essential variables. The variables can have arbitrary names and be in
any order. Here is an example using a custom formatted
<code>data.frame</code> of Argos LS data as input:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(sese2_n)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>sese2_n</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 295 × 5</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    longitude latitude time                lc    id       </span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;               &lt;fct&gt; &lt;chr&gt;    </span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1      72.5    -50.2 2009-02-01 17:50:46 A     ct36-E-09</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2      73.0    -50.4 2009-02-02 03:30:26 A     ct36-E-09</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3      73.8    -50.8 2009-02-02 17:50:48 B     ct36-E-09</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4      74.6    -51.2 2009-02-03 07:39:08 A     ct36-E-09</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5      74.9    -51.4 2009-02-03 15:29:59 A     ct36-E-09</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6      75.5    -51.6 2009-02-04 01:21:08 A     ct36-E-09</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7      76.0    -52.2 2009-02-04 16:34:15 A     ct36-E-09</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8      76.7    -52.2 2009-02-04 21:05:50 A     ct36-E-09</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9      77.0    -52.7 2009-02-05 10:57:22 A     ct36-E-09</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10      77.8    -52.8 2009-02-05 16:03:58 A     ct36-E-09</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 285 more rows</span></span></code></pre></div>
<p>Note the columns are in a different order than the default expected
by <code>aniMotum</code>, and the first three variables have different
names: <code>longitude</code>, <code>latitude</code> and
<code>time</code>. There are two approaches to format these data. The
first, is to call <code>format_data</code> as a data pre-processing step
prior to fitting an SSM. The data are linked to the expected names via
the following arguments to <code>format_data</code>: <code>id</code>,
<code>date</code>, <code>lc</code>, <code>coord</code>,
<code>epar</code> and <code>sderr</code>. In this example, we only need
to use the <code>date</code> and <code>coord</code> arguments:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">format_data</span>(sese2_n, <span class="at">date =</span> <span class="st">&quot;time&quot;</span>, <span class="at">coord =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>d</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 295 × 10</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    id      date                lc      lon   lat  smaj  smin   eor lonerr laterr</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;dttm&gt;              &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 ct36-E… 2009-02-01 17:50:46 A      72.5 -50.2    NA    NA    NA     NA     NA</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 ct36-E… 2009-02-02 03:30:26 A      73.0 -50.4    NA    NA    NA     NA     NA</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 ct36-E… 2009-02-02 17:50:48 B      73.8 -50.8    NA    NA    NA     NA     NA</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 ct36-E… 2009-02-03 07:39:08 A      74.6 -51.2    NA    NA    NA     NA     NA</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 ct36-E… 2009-02-03 15:29:59 A      74.9 -51.4    NA    NA    NA     NA     NA</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 ct36-E… 2009-02-04 01:21:08 A      75.5 -51.6    NA    NA    NA     NA     NA</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 ct36-E… 2009-02-04 16:34:15 A      76.0 -52.2    NA    NA    NA     NA     NA</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 ct36-E… 2009-02-04 21:05:50 A      76.7 -52.2    NA    NA    NA     NA     NA</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 ct36-E… 2009-02-05 10:57:22 A      77.0 -52.7    NA    NA    NA     NA     NA</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 ct36-E… 2009-02-05 16:03:58 A      77.8 -52.8    NA    NA    NA     NA     NA</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 285 more rows</span></span></code></pre></div>
<p>We then fit the SSM to the formatted data <code>d</code> via
<code>fit_ssm</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">fit_ssm</span>(d,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">model =</span> <span class="st">&quot;crw&quot;</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">time.step =</span> <span class="dv">24</span>)</span></code></pre></div>
<p>Alternatively, we can use a shortcut and have <code>fit_ssm</code>
format the <code>sese2_n</code> data by adding the variable name
arguments to the call:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">fit_ssm</span>(sese2_n,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">date =</span> <span class="st">&quot;time&quot;</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">coord =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>,<span class="st">&quot;latitude&quot;</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">model =</span> <span class="st">&quot;crw&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">time.step =</span> <span class="dv">24</span>)</span></code></pre></div>
<p>Original variable names are not preserved in the output object
<code>fit</code> but rather transformed to the default expected names.
The <code>grab</code> function can be used to access the data and the
SSM estimates (see Access Results, below).</p>
<p><code>fit_ssm</code> can be applied to single or multiple tracks,
without modification. The specified SSM is fit to each individual
separately and the resulting output is a compound <code>tibble</code>
with rows corresponding to each individual <code>ssm_df</code> fit
object. The <code>converged</code> column indicates whether each model
fit converged successfully.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## fit to data with two individuals</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">fit_ssm</span>(sese2,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">model =</span> <span class="st">&quot;crw&quot;</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">time.step=</span><span class="dv">24</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">control =</span> <span class="fu">ssm_control</span>(<span class="at">verbose =</span> <span class="dv">0</span>))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="do">## list fit outcomes for both seals</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>fit</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 × 5</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id        ssm          converged pdHess pmodel</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;named list&gt; &lt;lgl&gt;     &lt;lgl&gt;  &lt;chr&gt; </span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 ct36-E-09 &lt;ssm [15]&gt;   TRUE      TRUE   crw   </span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 ct36-F-09 &lt;ssm [15]&gt;   TRUE      TRUE   crw</span></span></code></pre></div>
<p>Individual <code>id</code> is displayed in the 1st column, all fit
output resides in a list (<code>ssm</code>) in the 2nd column,
<code>convergence</code> status (whether the optimizer found a global
minimum) of each model fit is displayed in the 3rd column, whether the
Hessian matrix was positive-definite and could be solved to obtain
parameter standard errors (<code>pdHess</code>) is displayed in the 4th
column, and the specified process model (<code>rw</code>,
<code>crw</code>, or <code>mp</code>) in the 5th column. In some cases,
the optimizer will converge but the Hessian matrix is not
positive-definite, which typically indicates the optimizer converged on
a local minimum. In this case, some standard errors may be calculated
but not all. One possible solution is to try specifying a longer
<code>time.step</code> or set <code>time.step = NA</code> to turn off
predictions and return only fitted values (location estimates at the
pre-filtered observation times). If <code>pdHess = FALSE</code> persists
then careful inspection of the supplied data is warranted to determine
if suspect observations not identified by <code>prefilter</code> are
present. The excellent <a href="https://CRAN.R-project.org/package=glmmTMB/vignettes/troubleshooting.html">glmmTMB
troubleshooting vignette</a> may also provide hints at solutions.
Convergence failures should be examined for potential data issues,
however, in some cases changes to the optimization parameters via
<code>ssm_control()</code> (see <code>?fit_ssm</code> and
<code>?ssm_control</code> on usage) may overcome mild issues (see
<code>?nlminb</code> or <code>?optim</code> for details on optimization
control parameters).</p>
</div>
</div>
<div id="access-results" class="section level3">
<h3>Access results</h3>
<p>Summary information about the fit can be obtained via the
<code>summary</code> function:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Animal id Model Time n.obs n.filt n.fit n.pred n.rr converged   AICc</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ct36-E-09   crw   24   170     26   144     58    .      TRUE 2952.2</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  ct36-F-09   crw   24   125     24   101    110    .      TRUE 2392.4</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; --------------</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ct36-E-09 </span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; --------------</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Parameter Estimate Std.Err</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          D   0.2061  0.0358</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      rho_o   0.1326  0.1183</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      tau_x   0.9748  0.0779</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      tau_y   0.6788  0.0579</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; --------------</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ct36-F-09 </span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; --------------</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Parameter Estimate Std.Err</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          D   0.0854  0.0157</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      rho_o   0.3656  0.1298</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      tau_x   1.4332  0.1481</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      tau_y    2.096  0.2137</span></span></code></pre></div>
<p>The summary table lists information about the fit, including the
number of observations in the input data (<code>n.obs</code>), the
number of observation flagged to be ignored by the SSM
(<code>n.filt</code>), the number of fitted location estimates
(<code>n.fit</code>), the number of predicted location estimates
(<code>n.pred</code>), the number of rerouted location estimates (if
present, <code>n.rr</code>), model convergence status, and AICc. When
fitting to multiple individuals, these statistics are repeated on
separate lines for each individual. Separate tables of SSM parameter
estimates and their SE’s are also printed for each individual. The
parameter estimates displayed vary depending on the SSM process model
selected by the user (<code>rw</code>, <code>crw</code>, or
<code>mp</code>) and the automatically chosen measurement model(s).
Here, <code>sigma_x</code> and <code>sigma_y</code> are the process
error standard deviations in the x and y directions, <code>rho_p</code>
is the correlation parameter in the covariance term. The
<code>Std. Error</code> column lists the standard errors, calculated via
the Delta method (see TMB documentation for details), for each estimated
parameter.</p>
<p><code>fit_ssm</code> usually returns two sets of estimated locations
in the model fit object: fitted values and predicted values. The fitted
values occur at the times of the observations to which the SSM was fit
(i.e., the observations that passed the pre-filter step). The predicted
values occur at the regular time intervals specified by the
<code>time.step</code> argument. If <code>time.step = NA</code>, then no
predicted values are estimated or returned in the model fit object.</p>
<p>Users can obtain the fitted or predicted locations as a data.frame by
using <code>grab()</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## grab fitted locations</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>floc <span class="ot">&lt;-</span> <span class="fu">grab</span>(fit, <span class="at">what =</span> <span class="st">&quot;fitted&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>floc[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 14</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id     date                  lon   lat     x      y   x.se   y.se     u      v</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;  &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 ct36-… 2009-02-01 17:50:46  72.5 -50.2 8069. -6450.  0.485  0.482 0.339 -0.233</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 ct36-… 2009-02-02 03:30:26  72.8 -50.4 8108. -6477. 11.7    9.55  4.04  -2.80 </span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 ct36-… 2009-02-02 17:50:48  73.7 -50.8 8199. -6549. 19.0   14.1   6.41  -5.00 </span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 ct36-… 2009-02-03 07:39:08  74.5 -51.2 8291. -6619. 14.9   10.4   6.65  -5.09 </span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 ct36-… 2009-02-03 15:29:59  74.9 -51.4 8339. -6655. 13.9    9.65  6.12  -4.64 </span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 4 more variables: u.se &lt;dbl&gt;, v.se &lt;dbl&gt;, s &lt;dbl&gt;, s.se &lt;lgl&gt;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="do">## grab predicted locations in projected form</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>ploc <span class="ot">&lt;-</span> <span class="fu">grab</span>(fit, <span class="at">what =</span> <span class="st">&quot;predicted&quot;</span>, <span class="at">as_sf =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>ploc[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 5 features and 10 fields</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: 8068.437 ymin: -6912.527 xmax: 8675.541 ymax: -6449.872</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; CRS:           +proj=merc +lon_0=0 +datum=WGS84 +units=km +no_defs</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 11</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id      date                       u         v    u.se    v.se    x.se    y.se</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;dttm&gt;                 &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 ct36-E… 2009-02-01 17:00:00 9.73e-11 -6.67e-11 1.00e-5 1.00e-5 1.00e-5 1.00e-5</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 ct36-E… 2009-02-02 17:00:00 6.38e+ 0 -4.98e+ 0 1.12e+0 9.47e-1 1.83e+1 1.36e+1</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 ct36-E… 2009-02-03 17:00:00 6.06e+ 0 -4.63e+ 0 1.31e+0 1.16e+0 1.43e+1 1.01e+1</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 ct36-E… 2009-02-04 17:00:00 5.74e+ 0 -5.36e+ 0 1.03e+0 8.38e-1 1.33e+1 9.30e+0</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 ct36-E… 2009-02-05 17:00:00 9.34e+ 0 -5.43e+ 0 1.20e+0 1.09e+0 1.28e+1 9.14e+0</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 3 more variables: s &lt;dbl&gt;, s.se &lt;lgl&gt;, geometry &lt;POINT [km]&gt;</span></span></code></pre></div>
<p>Here, the output from the <code>crw</code> SSM is returned as a
fitted location data.frame (floc) that includes individual id, date,
longitude, latitude, x and y (typically from the default Mercator
projection) and their standard errors (<code>x.se</code>,
<code>y.se</code> in km), <code>u</code>, <code>v</code> (and their
standard errors, <code>u.se</code>, <code>v.se</code> in km/h) are
estimates of signed velocity in the x and y directions. The
<code>u</code>, <code>v</code> velocities should generally be ignored as
their estimation uses time intervals between consecutive locations,
whether they are observation times or prediction times. The columns
<code>s</code> and <code>s.se</code> provide a more reliable 2-D
velocity estimate, although standard error estimation is turned off by
default as this generally increases computation time for the
<code>crw</code> SSM. Standard error estimation for <code>s</code> can
be turned on via the <code>control</code> argument to
<code>fit_ssm</code>
(i.e. <code>control = ssm_control(se = TRUE)</code>, see
<code>?ssm_control</code> for futher details).</p>
<p>The predicted location data.frame (ploc) is an <code>sf-tibble</code>
with geometry and Coordinate Reference System information. This
<code>sf</code> output format can be useful for custom mapping or
calculating derived variables from the estimated locations.</p>
<p>The formatted and prefiltered version of the input data can also be
extracted from the output:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fp.data <span class="ot">&lt;-</span> <span class="fu">grab</span>(fit, <span class="at">what =</span> <span class="st">&quot;data&quot;</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fp.data[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 × 14</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   id       date                lc      lon   lat  smaj  smin   eor obs.t…¹ keep </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;    &lt;dttm&gt;              &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;lgl&gt;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 ct36-E-… 2009-02-01 17:50:46 A      72.5 -50.2    NA    NA    NA LS      TRUE </span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 ct36-E-… 2009-02-02 03:30:26 A      73.0 -50.4    NA    NA    NA LS      TRUE </span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 ct36-E-… 2009-02-02 17:50:48 B      73.8 -50.8    NA    NA    NA LS      TRUE </span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 ct36-E-… 2009-02-03 07:39:08 A      74.6 -51.2    NA    NA    NA LS      TRUE </span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 ct36-E-… 2009-02-03 15:29:59 A      74.9 -51.4    NA    NA    NA LS      TRUE </span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 4 more variables: x &lt;dbl&gt;, y &lt;dbl&gt;, emf.x &lt;dbl&gt;, emf.y &lt;dbl&gt;, and</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   abbreviated variable name ¹​obs.type</span></span></code></pre></div>
<p>Here, <code>fp.data</code> is in the form that is passed to the
<code>crw</code> SSM. The first 5 columns (<code>id</code>,
<code>date</code>, <code>lc</code>, <code>lon</code>, <code>lat</code>)
are preserved from the formatted input data, and the error ellipse
parameter columns (<code>smaj</code>, <code>smin</code>,
<code>eor</code>) are appended and filled with NA’s, if missing from the
input data. The observation type, <code>obs.type</code>, is determined
for each observation during the prefiltering stage based on the
combination of <code>lc</code> value and the presence of error ellipse
parameters with non-NA values. The <code>keep</code> column indicates
whether each record passed the pre-filtering stage (see
<code>?prefilter</code> for details), observations with
<code>keep = FALSE</code> are ignored by the SSM. The
<code>x</code>,<code>y</code> columns are the Mercator-projected
coordinates (in km) that fitted to by the SSM. The <code>emf.x</code>
and <code>emf.y</code> columns are the error multiplication factors used
to scale the measurement error variances, used by the SSM, for each
Argos Least-Squares location class - these are relevant only for
<code>obs.type = &#39;LS&#39;</code> and for GPS observations.</p>
</div>
<div id="visualising-a-model-fit" class="section level3">
<h3>Visualising a model fit</h3>
<p>A generic <code>plot</code> (see <code>?plot.ssm_df</code>) method
allows a quick visual of the SSM fit to the data:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot time-series of the fitted values</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit, <span class="at">what =</span> <span class="st">&quot;fitted&quot;</span>, <span class="at">type =</span> <span class="dv">1</span>, <span class="at">pages =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="images/overview/fit_plot1.jpg" style="width:95.0%" /> Here,
the fitted values (state estimates corresponding to the time of each
observation; orange points) are plotted on top of the observations that
passed the <code>prefilter</code> stage (blue points and blue rug at
bottom) and as separate time-series for the x and y coordinates by
default. Uncertainty in the estimates is displayed as 2 x SE intervals
(orange-filled ribbon). Observations that failed the
<code>prefilter</code> stage are also displayed (black x’s and black rug
at bottom).</p>
<p>A 2-D time series plot of the track is invoked by the argument
<code>type = 2</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot fitted values as a 2-d track</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit, <span class="at">what =</span> <span class="st">&quot;predicted&quot;</span>, <span class="at">type =</span> <span class="dv">2</span>, <span class="at">pages =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="images/overview/fit_plot2.jpg" style="width:95.0%" /> The
predicted values (orange points) are the state estimates predicted at
regular time intervals, specified by <code>time.step</code> (here a 24 h
interval). 95 % confidence ellipses (orange-filled ellipses) around the
predicted values are also displayed, but can be faded away by choosing a
low <code>alpha</code> value (e.g.,
<code>plot(fit, what = &quot;predicted&quot;, type = 2, alpha = 0.05)</code>).
Observations that failed the <code>prefilter</code> stage are displayed
(black x’s) by default but can be turned off with the argument
<code>outlier = FALSE</code>).</p>
</div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>Auger-Méthé M, Albertsen CM, Jonsen ID, Derocher AE, Lidgard DC,
Studholme KR, Bowen WD, Crossin GT, Flemming JM (2017) Spatiotemporal
modelling of marine movement data using Template Model Builder (TMB).
Marine Ecology Progress Series 565:237-249.</p>
<p>Jonsen ID, McMahon CR, Patterson TA, Auger-Méthé M. Harcourt R,
Hindel MA, Bestley S (2019) Movement responses to environment: fast
inference of variation among southern elephant seals with a mixed effect
model. Ecoloogy 100:e02566.</p>
<p>Jonsen ID, Patterson TA, Costa DP, Doherty PD, Godley BJ, Grecian WJ,
Guinet C, Hoenner X, Kienle SS, Robinson PW, Votier SC, Whiting S, Witt
MJ, Hindel MA, Harcourt RG, McMahon CR (2020) A continuous-time
state-space model for rapid quality control of Argos locations from
animal-borne tags. Movement Ecology 8:31.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
